# Chapter 15 A3T-GCNì„ ì‚¬ìš©í•œ êµí†µ ì˜ˆì¸¡

> **í•µì‹¬ ì§ˆë¬¸**: ì‹œê³„ì—´ ê·¸ë˜í”„ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ë¯¸ë˜ì˜ êµí†µ ì†ë„ë¥¼ ì–´ë–»ê²Œ ì •í™•í•˜ê²Œ ì˜ˆì¸¡í•  ìˆ˜ ìˆì„ê¹Œ?

---

## ğŸ“‹ ëª©ì°¨
1. [ğŸš¦ ë¬¸ì œ ì •ì˜ì™€ ë™ê¸°](#-ë¬¸ì œ-ì •ì˜ì™€-ë™ê¸°)
2. [ğŸ”¬ PeMS-M ë°ì´í„°ì…‹ íƒìƒ‰](#-pems-m-ë°ì´í„°ì…‹-íƒìƒ‰)
3. [ğŸ”„ ë°ì´í„°ì…‹ ì²˜ë¦¬](#-ë°ì´í„°ì…‹-ì²˜ë¦¬)
4. [ğŸ›ï¸ A3T-GCN ì•„í‚¤í…ì²˜ êµ¬í˜„](#ï¸-a3t-gcn-ì•„í‚¤í…ì²˜-êµ¬í˜„)
5. [ğŸ“ˆ ì‹¤í—˜ ê²°ê³¼ ë° ì„±ëŠ¥ í‰ê°€](#-ì‹¤í—˜-ê²°ê³¼-ë°-ì„±ëŠ¥-í‰ê°€)
6. [ğŸ¯ í•™ìŠµí•œ ë‚´ìš© ìš”ì•½](#-í•™ìŠµí•œ-ë‚´ìš©-ìš”ì•½)

---

## ğŸš¦ ë¬¸ì œ ì •ì˜ì™€ ë™ê¸°

### êµí†µ ì˜ˆì¸¡ì˜ ë³µì¡ì„±

ì œ13ì¥ì—ì„œ T-GNNì„ ì†Œê°œí–ˆì§€ë§Œ, ì£¼ëœ ì‘ìš© ë¶„ì•¼ì¸ êµí†µ ì˜ˆì¸¡ì— ëŒ€í•´ ìì„¸íˆ ë‹¤ë£¨ì§€ ì•Šì•˜ë‹¤. ìµœê·¼ ëª‡ ë…„ê°„ ìŠ¤ë§ˆíŠ¸ ì‹œí‹° ê°œë…ì´ ì ì  ì¸ê¸°ë¥¼ ì–»ê³  ìˆë‹¤. ìŠ¤ë§ˆíŠ¸ ì‹œí‹°ëŠ” ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ìš´ì˜ ë° ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê³  ê°œì„ í•˜ëŠ” ë„ì‹œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

> **êµí†µ ì˜ˆì¸¡ì´ ì–´ë ¤ìš´ ì´ìœ **

| ì˜ì¡´ì„± ìœ í˜• | ì„¤ëª… | ì˜ˆì‹œ |
|-------------|------|------|
| **ì‹œê°„ì  ì˜ì¡´ì„±** | êµí†µ íŒ¨í„´ì˜ ê³„ì ˆì„±, ì£¼ê¸°ì„±, íŠ¸ë Œë“œê°€ ë³µì¡í•˜ê²Œ ì–½í˜€ìˆìŒ | ì¶œí‡´ê·¼ ì‹œê°„, ì£¼ë§ íŒ¨í„´ |
| **ê³µê°„ì  ì˜ì¡´ì„±** | ì¸ì ‘ ë„ë¡œ ê°„ì˜ ìƒí˜¸ ì˜í–¥ì´ ì˜ˆì¸¡ì„ ì–´ë µê²Œ ë§Œë“¦ | êµí†µ ì²´ì¦ì˜ í™•ì‚° |
| **ë¹„ì„ í˜•ì„±** | êµí†µ íë¦„ì˜ ë³µì¡í•œ ìƒí˜¸ì‘ìš©ìœ¼ë¡œ ì¸í•œ ì˜ˆì¸¡ ë¶ˆí™•ì‹¤ì„± | ì‚¬ê³ , ë‚ ì”¨, ì´ë²¤íŠ¸ |

### ìŠ¤ë§ˆíŠ¸ ì‹œí‹°ì—ì„œì˜ ì¤‘ìš”ì„±

ì •í™•í•œ êµí†µ ì˜ˆì¸¡ì€ êµí†µ ê´€ë¦¬ìì—ê²Œ ì‹ í˜¸ ìµœì í™”, ì¸í”„ë¼ ê³„íš ë° í˜¼ì¡ë„ ê°ì†Œ ë“±ì˜ ë°©ë©´ì—ì„œ í° ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤.

| ì ìš© ë¶„ì•¼ | ì„¤ëª… | íš¨ê³¼ |
|-----------|------|------|
| **ì‹ í˜¸ ìµœì í™”** | ì‹¤ì‹œê°„ êµí†µëŸ‰ì— ë”°ë¥¸ ì‹ í˜¸ íƒ€ì´ë° ì¡°ì • | êµí†µ íë¦„ ê°œì„  |
| **ì¸í”„ë¼ ê³„íš** | ë„ë¡œ í™•ì¥ ë° ìƒˆë¡œìš´ ë„ë¡œ ê±´ì„¤ ê³„íš ìˆ˜ë¦½ | ì¥ê¸°ì  íˆ¬ì íš¨ìœ¨ì„± |
| **í˜¼ì¡ë„ ê°ì†Œ** | ëŒ€ì•ˆ ê²½ë¡œ ì œì•ˆ ë° êµí†µ ë¶„ì‚° ì „ëµ | ì‹¤ì‹œê°„ êµí†µ ì•ˆë‚´ |

---

## ğŸ”¬ PeMS-M ë°ì´í„°ì…‹ íƒìƒ‰

### ë°ì´í„°ì…‹ ì†Œê°œ

ë³¸ ì¥ì—ì„œëŠ” íŠ¹ì • êµí†µ ì˜ˆì¸¡ ì‚¬ë¡€ì— T-GNNì„ ì ìš©í•  ê²ƒì´ë‹¤. ë¨¼ì € ìƒˆë¡œìš´ ë°ì´í„°ì…‹ì„ íƒìƒ‰í•˜ê³  ì²˜ë¦¬í•˜ì—¬ ì›ë³¸ CSV íŒŒì¼ì—ì„œ ì‹œê³„ì—´ ê·¸ë˜í”„ë¥¼ ìƒì„±í•  ê²ƒì´ë‹¤.

**PeMS-M ë°ì´í„°ì…‹**ì€ PeMSD7ì˜ ì¤‘ê°„ í¬ê¸° ë²„ì „ìœ¼ë¡œ, California District 7ì˜ 228ê°œ ì„¼ì„œ ìŠ¤í…Œì´ì…˜ì—ì„œ ìˆ˜ì§‘ëœ êµí†µ ì†ë„ ë°ì´í„°ì´ë‹¤. ì´ ë°ì´í„°ëŠ” 2012ë…„ 5-6ì›” í‰ì¼ ë™ì•ˆ 30ì´ˆë§ˆë‹¤ ì¸¡ì •ë˜ê³  5ë¶„ë§ˆë‹¤ ì§‘ê³„ëœ ê³ í•´ìƒë„ ë°ì´í„°ì´ë‹¤.

> **ğŸ’» ê¸°ìˆ  ìš”êµ¬ì‚¬í•­**: ì´ ì¥ì˜ ì½”ë“œëŠ” ìƒë‹¹í•œ GPU ë¦¬ì†ŒìŠ¤ë¥¼ ìš”êµ¬í•˜ë©°, í›ˆë ¨ ì„¸íŠ¸ í¬ê¸°ë¥¼ ì¤„ì—¬ì„œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

### ë°ì´í„° ë‹¤ìš´ë¡œë“œ ë° ë¡œë“œ

ê²°ê³¼ í´ë”ëŠ” ë‘ íŒŒì¼(V_228.csv, W_228.csv)ì„ í¬í•¨í•˜ê³  ìˆë‹¤. V_228.csvíŒŒì¼ì€ 228ê°œì˜ ì„¼ì„œ ìŠ¤í…Œì´ì…˜ì—ì„œ ìˆ˜ì§‘í•œ êµí†µ ì†ë„ë¥¼ ë³´ì—¬ì£¼ê³  W_228.csvëŠ” ìŠ¤í…Œì´ì…˜ê°„ì˜ ê±°ë¦¬ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

```python
# ë°ì´í„° ë‹¤ìš´ë¡œë“œ
from io import BytesIO
from urllib.request import urlopen
from zipfile import ZipFile

url = 'https://github.com/VeritasYin/STGCN_IJCAI-18/raw/master/dataset/PeMSD7_Full.zip'
with urlopen(url) as zurl:
    with ZipFile(BytesIO(zurl.read())) as zfile:
        zfile.extractall('.')

# ë°ì´í„° ë¡œë“œ
import pandas as pd
speeds = pd.read_csv('PeMSD7_V_228.csv', names=range(0,228))
distances = pd.read_csv('PeMSD7_W_228.csv', names=range(0,228))
```

pandas ëª¨ë“ˆì„ ì´ìš©í•˜ì—¬ ì´ë“¤ì„ ë¶ˆëŸ¬ì˜¨ë‹¤. ì‰¬ìš´ ì ‘ê·¼ì„ ìœ„í•´ range()ë¥¼ ì´ìš©í•˜ì—¬ ì—´ ì´ë¦„ì„ ë°”ê¿€ ê²ƒì´ë‹¤.

### êµí†µ ì†ë„ ì‹œê°í™”

ìš°ë¦¬ê°€ ì´ ë°ì´í„°ì…‹ì„ ì´ìš©í•´ì„œ í•˜ê³ ì í•˜ëŠ” ê²ƒì€ êµí†µ ì†ë„ì˜ ë³€í™”ë¥¼ ì‹œê°í™”í•˜ëŠ” ê²ƒì´ë‹¤. ì‹œê³„ì—´ ì˜ˆì¸¡ì— ìˆì–´ ê³„ì ˆì„±ê³¼ ê°™ì€ íŠ¹ì„±ì€ ë§¤ìš° ìœ ìš©í•˜ê³  ì´ëŠ” ì‹œê³„ì—´ ì˜ˆì¸¡ì— ìˆì–´ ê³ ì „ì ì¸ ë°©ì‹ì´ë‹¤. ë°˜ë©´ì—, ë¹„ì •ìƒì ì¸(non-stationary) ì‹œê³„ì—´ì€ ì‚¬ìš©ë˜ê¸° ì „ì— ì¶”ê°€ì ì¸ ì²˜ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆë‹¤.

matplotlibë¥¼ ì‚¬ìš©í•´ì„œ ì‹œê°„ì— ë”°ë¥¸ êµí†µ ì†ë„ë¥¼ ì‹œê°í™” í•´ë³´ì.

```python
import numpy as np
import matplotlib.pyplot as plt

plt.figure(figsize=(10,5), dpi=100) 
plt.plot(speeds) 
plt.grid(linestyle=':') 
plt.xlabel('Time (5 min)') 
plt.ylabel('Traffic speed')
```

![êµí†µ ì†ë„ ì‹œê°í™”](./images/traffic_speed.png)

**ë¶„ì„ ê²°ê³¼**:

| ê´€ì°° ì‚¬í•­ | ì„¤ëª… | ì˜ë¯¸ |
|-----------|------|------|
| **ì‹œê°„ì  íŒ¨í„´** | 24ì‹œê°„ ì£¼ê¸°ë¡œ ë°˜ë³µë˜ëŠ” êµí†µ íŒ¨í„´ì´ ëª…í™•íˆ ê´€ì°°ë¨ | ì¼ì¼ êµí†µ íŒ¨í„´ì˜ ê·œì¹™ì„± |
| **ë³€ë™ì„±** | ì‹œê°„ëŒ€ë³„ë¡œ êµí†µ ì†ë„ì˜ í° ë³€ë™ì´ ë‚˜íƒ€ë‚¨ | êµí†µ ìƒí™©ì˜ ë™ì  íŠ¹ì„± |
| **ë…¸ì´ì¦ˆ** | ì„¼ì„œë³„ë¡œ ë‹¤ì–‘í•œ ì†ë„ íŒ¨í„´ì´ ì¡´ì¬ | ê°œë³„ ì„¼ì„œì˜ íŠ¹ì„± ì°¨ì´ |

### í‰ê·  ë° í‘œì¤€í¸ì°¨ ë¶„ì„

í‰ê· ê³¼ í‘œì¤€í¸ì°¨ë¥¼ ê³„ì‚°í•˜ì—¬ ì „ì²´ì ì¸ íŒ¨í„´ì„ íŒŒì•…í•´ë³´ì.

```python
# í‰ê· ê³¼ í‘œì¤€í¸ì°¨ ê³„ì‚°
mean = speeds.mean(axis=1)
std = speeds.std(axis=1)

plt.figure(figsize=(10,5), dpi=100)
plt.plot(mean, 'k-')
plt.grid(linestyle=':')
plt.fill_between(mean.index, mean-std, mean+std, color='r', alpha=0.1)
plt.xlabel('Time (5 min)')
plt.ylabel('Traffic speed')
```

![í‰ê·  ë° í‘œì¤€í¸ì°¨ ë¶„ì„](./images/traffic_speed2.png)

**ë¶„ì„ ê²°ê³¼**:

| ë¶„ì„ í•­ëª© | ì„¤ëª… | íŠ¹ì§• |
|-----------|------|------|
| **í‰ê·  íŒ¨í„´** | ì „ì²´ ì„¼ì„œì˜ í‰ê·  êµí†µ ì†ë„ëŠ” ë¹„êµì  ì•ˆì •ì ì¸ íŒ¨í„´ì„ ë³´ì„ | ì „ì²´ì ì¸ êµí†µ íë¦„ì˜ ì¼ê´€ì„± |
| **í‘œì¤€í¸ì°¨** | ì‹œê°„ëŒ€ë³„ë¡œ ë³€ë™ì„±ì´ ë‹¤ë¥´ë©°, êµí†µ í˜¼ì¡ ì‹œê°„ëŒ€ì— ë†’ì€ ë³€ë™ì„± | êµí†µ ìƒí™©ì˜ ë¶ˆí™•ì‹¤ì„± |
| **ì‹ ë¢°êµ¬ê°„** | ë¹¨ê°„ìƒ‰ ì˜ì—­ìœ¼ë¡œ í‘œì‹œëœ ë³€ë™ ë²”ìœ„ê°€ ì‹œê°„ëŒ€ë³„ë¡œ ë‹¤ë¦„ | ì˜ˆì¸¡ì˜ ì–´ë ¤ì›€ ì •ë„ |

### ê±°ë¦¬ ë° ìƒê´€ê´€ê³„ í–‰ë ¬ ë¶„ì„

ìš°ë¦¬ëŠ” ë˜í•œ ë‹¤ë¥¸ ê²½ë¡œë“¤ ê°„ì˜ ì‹œê³„ì—´ ìƒê´€ê´€ê³„ë¥¼ ì‹œê°í™”í•  ìˆ˜ë„ ìˆë‹¤. ì´ë¥¼ í†µí•´ ì„¼ì„œ ê°„ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

```python
# ê±°ë¦¬ í–‰ë ¬ê³¼ ìƒê´€ê´€ê³„ í–‰ë ¬ ì‹œê°í™”
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(8, 8))
fig.tight_layout(pad=3.0)

# ê±°ë¦¬ í–‰ë ¬
ax1.matshow(distances)
ax1.set_xlabel("Sensor station")
ax1.set_ylabel("Sensor station")
ax1.title.set_text("Distance matrix")

# ìƒê´€ê´€ê³„ í–‰ë ¬ (ìŒìˆ˜ë¡œ ë³€í™˜í•˜ì—¬ ì‹œê°í™”)
ax2.matshow(-np.corrcoef(speeds.T))
ax2.set_xlabel("Sensor station")
ax2.set_ylabel("Sensor station")
ax2.title.set_text("Correlation matrix")
```

![ê±°ë¦¬ ë° ìƒê´€ê´€ê³„ í–‰ë ¬](./images/dist_correlation_matrix.png)

**ë¶„ì„ ê²°ê³¼**:

| í–‰ë ¬ ìœ í˜• | íŠ¹ì§• | ì˜ë¯¸ |
|-----------|------|------|
| **ê±°ë¦¬ í–‰ë ¬** | ëŒ€ê°ì„ ì´ 0 (ìê¸° ìì‹ ê³¼ì˜ ê±°ë¦¬), ëŒ€ì¹­ í–‰ë ¬ êµ¬ì¡° | ì„¼ì„œ ê°„ ë¬¼ë¦¬ì  ê±°ë¦¬ |
| **ìƒê´€ê´€ê³„ í–‰ë ¬** | ì–´ë‘ìš¸ìˆ˜ë¡ ë†’ì€ ìƒê´€ê´€ê³„, ë°ì„ìˆ˜ë¡ ë‚®ì€ ìƒê´€ê´€ê³„ | ì„¼ì„œ ê°„ êµí†µ íŒ¨í„´ ìœ ì‚¬ì„± |
| **ê³µê°„ì  íŒ¨í„´** | ê°€ê¹Œìš´ ì„¼ì„œë“¤ì´ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ë³´ì´ëŠ” ì§€ì—­ì  íŠ¹ì„± | ì§€ì—­ì  êµí†µ íë¦„ì˜ ì—°ê´€ì„± |

ê·¸ë¦¼ 15.4ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ì–´ë‘ìš¸ìˆ˜ë¡ ì§§ì€ ê±°ë¦¬ì™€ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ê³  ë°ì„ìˆ˜ë¡ ê¸´ ê±°ë¦¬ì™€ ë‚®ì€ ìƒê´€ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. ê·¸ëŸ¬ë‚˜ ê¸´ ê±°ë¦¬ ê°„ì˜ ìŠ¤í…Œì´ì…˜ë“¤ì´ ë°˜ë“œì‹œ ë†’ì€ ìƒê´€ê´€ê³„ë¥¼ ê°€ì§ˆ í•„ìš”ëŠ” ì—†ë‹¤. ì´ëŠ” ë°ì´í„°ì…‹ì˜ ëª¨ë“  ì„¼ì„œ ìŠ¤í…Œì´ì…˜ì„ ê³ ë ¤í•˜ëŠ” ê²ƒì´ êµí†µ ì˜ˆì¸¡ì— ì¤‘ìš”í•¨ì„ ì˜ë¯¸í•œë‹¤. íŠ¹íˆ ê°€ê¹Œìš´ ìŠ¤í…Œì´ì…˜ë“¤ì´ ë§¤ìš° ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆì–´ êµí†µ ì˜ˆì¸¡ì„ ë”ìš± ì–´ë µê²Œ ë§Œë“ ë‹¤.

---

## ğŸ”„ ë°ì´í„°ì…‹ ì²˜ë¦¬

### ê°€ì¤‘ ì¸ì ‘ í–‰ë ¬ ê³„ì‚°

ë°ì´í„°ì…‹ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ë¥¼ ì–»ì—ˆìœ¼ë¯€ë¡œ, T-GNNì„ í›ˆë ¨í•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ì²˜ë¦¬í•´ì•¼ í•œë‹¤. ì²« ë²ˆì§¸ ë‹¨ê³„ëŠ” êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ ì‹œê³„ì—´ ê·¸ë˜í”„ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰, ì„¼ì„œ ìŠ¤í…Œì´ì…˜ë“¤ì„ ì˜ë¯¸ ìˆëŠ” ë°©ì‹ìœ¼ë¡œ ì—°ê²°í•´ì•¼ í•œë‹¤.

ë‹¤í–‰íˆë„ ìŠ¤í…Œì´ì…˜ ê°„ì˜ ê±°ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê±°ë¦¬ í–‰ë ¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ìŠ¤í…Œì´ì…˜ë“¤ì„ ì—°ê²°í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì´ ë  ê²ƒì´ë‹¤.

ê±°ë¦¬ í–‰ë ¬ì—ì„œ ì¸ì ‘ í–‰ë ¬ì„ ê³„ì‚°í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‘ ìŠ¤í…Œì´ì…˜ ê°„ì˜ ê±°ë¦¬ê°€ í‰ê·  ê±°ë¦¬ë³´ë‹¤ ì‘ìœ¼ë©´ ë§í¬ë¥¼ í• ë‹¹í•  ìˆ˜ ìˆì§€ë§Œ, ì´ ì¥ì—ì„œëŠ” [2]ì—ì„œ ì†Œê°œëœ ê³ ê¸‰ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ê°€ì¤‘ ì¸ì ‘ í–‰ë ¬ì„ ê³„ì‚°í•  ê²ƒì´ë‹¤. ì´ì§„ ê°’ ëŒ€ì‹ , ì•„ë˜ ê³µì‹ì„ ì‚¬ìš©í•˜ì—¬ 0(ì—°ê²° ì—†ìŒ)ì—ì„œ 1(ê°•í•œ ì—°ê²°)ê¹Œì§€ì˜ ê°€ì¤‘ì¹˜ë¥¼ ê³„ì‚°í•  ê²ƒì´ë‹¤:

```
w_ij = { exp(-d_ij^2 / Ïƒ^2), if i â‰  j and exp(-d_ij^2 / Ïƒ^2) â‰¥ Îµ
       { 0, otherwise
```

ì—¬ê¸°ì„œ `w_ij`ëŠ” ë…¸ë“œ `i`ì™€ ë…¸ë“œ `j` ê°„ì˜ ê°€ì¤‘ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ê³ , `d_ij`ëŠ” ì´ ë‘ ë…¸ë“œ ê°„ì˜ ê±°ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ë©°, `Ïƒ^2`ì™€ `Îµ`ëŠ” ì¸ì ‘ í–‰ë ¬ì˜ ë¶„í¬ì™€ í¬ì†Œì„±ì„ ì œì–´í•˜ëŠ” ë‘ ì„ê³„ê°’ì´ë‹¤. [2]ì˜ êµ¬í˜„ ì½”ë“œëŠ” GitHubì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤. ê¸°ì¡´ ì„ê³„ê°’ `Ïƒ^2=0.1`ê³¼ `Îµ=0.5`ë¥¼ ì¬ì‚¬ìš©í•  ê²ƒì´ë‹¤.

Pythonì—ì„œ ì´ë¥¼ êµ¬í˜„í•˜ê³  ê²°ê³¼ ì¸ì ‘ í–‰ë ¬ì„ ê·¸ë ¤ë³´ì.

```python
def compute_adj(distances, sigma2=0.1, epsilon=0.5):
    d = distances.to_numpy() / 10000.  # ê±°ë¦¬ ì •ê·œí™”
    d2 = d * d                         # ê±°ë¦¬ ì œê³±
    n = distances.shape[0]             # ë…¸ë“œ ìˆ˜
    w_mask = np.ones([n, n]) - np.identity(n)  # ìê¸° ì—°ê²° ì œê±°
    return np.exp(-d2 / sigma2) * (np.exp(-d2 / sigma2) >= epsilon) * w_mask

# ì¸ì ‘ í–‰ë ¬ ê³„ì‚°
adj = compute_adj(distances)
```

### ì¸ì ‘ í–‰ë ¬ ì‹œê°í™”

```python
plt.figure(figsize=(8, 8))
cax = plt.matshow(adj, False)
plt.colorbar(cax)
plt.xlabel("Sensor station")
plt.ylabel("Sensor station")
```

![ì„¼ì„œ ìŠ¤í…Œì´ì…˜ ì¸ì ‘ í–‰ë ¬](./images/sensor_station.png)

**ë¶„ì„ ê²°ê³¼**:

| íŠ¹ì„± | ì„¤ëª… | ì˜ë¯¸ |
|------|------|------|
| **í¬ì†Œì„±** | ëŒ€ë¶€ë¶„ì˜ ì—°ê²°ì´ 0ìœ¼ë¡œ, ê±°ë¦¬ê°€ ë¨¼ ì„¼ì„œë“¤ì€ ì—°ê²°ë˜ì§€ ì•ŠìŒ | ì§€ì—­ì  ì—°ê²°ì„± |
| **ì§€ì—­ì„±** | ê°€ê¹Œìš´ ì„¼ì„œë“¤ë§Œ ì—°ê²°ë˜ì–´ ì§€ì—­ì  íŒ¨í„´ì„ í˜•ì„± | ê³µê°„ì  ì˜ì¡´ì„± ëª¨ë¸ë§ |
| **ê°€ì¤‘ì¹˜ ë¶„í¬** | ì—°ê²°ëœ ì„¼ì„œë“¤ ê°„ì˜ ê°€ì¤‘ì¹˜ëŠ” 0~1 ì‚¬ì´ì˜ ê°’ì„ ê°€ì§ | ì—°ê²° ê°•ë„ì˜ ì •ê·œí™” |

### ê·¸ë˜í”„ êµ¬ì¡° ì‹œê°í™”

NetworkXë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ê·¸ë˜í”„ êµ¬ì¡°ë¥¼ ì‹œê°í™”í•´ë³´ì.

```python
import matplotlib.pyplot as plt
import networkx as nx

def plot_graph(adj):
    plt.figure(figsize=(10,5))
    rows, cols = np.where(adj > 0)
    edges = zip(rows.tolist(), cols.tolist())
    G = nx.Graph()
    G.add_edges_from(edges)
    nx.draw(G, with_labels=True)
    plt.show()

plot_graph(adj)
```

![ì„¼ì„œ ë„¤íŠ¸ì›Œí¬ ê·¸ë˜í”„](./images/graph.png)

**ë¶„ì„ ê²°ê³¼**:

| ë„¤íŠ¸ì›Œí¬ íŠ¹ì„± | ì„¤ëª… | ì˜ë¯¸ |
|---------------|------|------|
| **ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°** | ì„¼ì„œë“¤ì´ ë³µì¡í•œ ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°ë˜ì–´ ìˆìŒ | êµí†µ ë„¤íŠ¸ì›Œí¬ì˜ ë³µì¡ì„± |
| **ì—°ê²° ë°€ë„** | ì¼ë¶€ ì„¼ì„œëŠ” ë§ì€ ì—°ê²°ì„, ì¼ë¶€ëŠ” ì ì€ ì—°ê²°ì„ ê°€ì§ | ì„¼ì„œì˜ ì¤‘ìš”ë„ ì°¨ì´ |
| **ì§€ì—­ì  í´ëŸ¬ìŠ¤í„°** | ê°€ê¹Œìš´ ì„¼ì„œë“¤ì´ í´ëŸ¬ìŠ¤í„°ë¥¼ í˜•ì„±í•˜ëŠ” ì§€ì—­ì  íŠ¹ì„± | ì§€ì—­ì  êµí†µ íŒ¨í„´ |

### ë°ì´í„° ì „ì²˜ë¦¬

ì´ì œ ë°ì´í„°ë¥¼ ì •ê·œí™”í•˜ê³  ì‹œê³„ì—´ ìŠ¬ë¼ì´ë”© ìœˆë„ìš°ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.

#### Z-score ì •ê·œí™”

ì •ê·œí™”ë¥¼ ìœ„í•´ z-score ì •ê·œí™”(z-score normalization)ë¥¼ ì„ íƒí•˜ëŠ”ë° ì´ë¥¼ ì—¬ê¸°ì„œ êµ¬í˜„í•˜ë„ë¡ í•˜ê² ë‹¤.

1. z-ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ë¥¼ ìƒì„±í•œë‹¤.

```python
def zscore(x, mean, std):
    return (x - mean) / std
```

2. ìš°ë¦¬ ë°ì´í„°ì…‹ì— ìœ„ í•¨ìˆ˜ë¥¼ ì ìš©í•˜ê³  ì •ê·œí™”í•˜ëŠ” í•¨ìˆ˜ë¥¼ ìƒì„±í•œë‹¤.

```python
# ë°ì´í„° ì •ê·œí™”
speeds_norm = zscore(speeds, speeds.mean(axis=0), speeds.std(axis=0))
```

3. ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```python
speeds_norm.head(1)
```

ì•„ë˜ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤:

| 0 | 1 | 2 | 3 | 4 | 5 | 6 | ... |
|---|---|---|---|---|---|---|-----|
| 0.950754 | 0.548255 | 0.502211 | 0.831672 | 0.793696 | 1.193806 | ... |

**ê·¸ë¦¼ 15.7 í‘œì¤€í™”ëœ ì†ë„ê°’ì˜ ì˜ˆì‹œ**

í‘œì¤€í™”ëœ ê°’ë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ê³„ì‚°ë˜ì—ˆê³ , ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ë…¸ë“œì— ëŒ€í•œ ì‹œê³„ì—´ì„ ìƒì„±í•  ê²ƒì´ë‹¤. ê° ì‹œê°„ tì— ëŒ€í•´ t+hì—ì„œì˜ ì†ë„ë¥¼ ì˜ˆì¸¡í•˜ê¸° ìœ„í•´ì„œëŠ” nê°œì˜ ì…ë ¥ ë°ì´í„° ìƒ˜í”Œì´ í•„ìš”í•˜ë‹¤. ì…ë ¥ ìƒ˜í”Œì˜ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë©”ëª¨ë¦¬ ìš”êµ¬ì‚¬í•­ì´ ì¦ê°€í•œë‹¤.

hëŠ” "Horizon"ì´ë¼ê³ ë„ í•˜ë©°, ì‘ì—…ì´ ë‹¨ê¸° ì˜ˆì¸¡ì¸ì§€ ì¥ê¸° ì˜ˆì¸¡ì¸ì§€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ì´ ì˜ˆì œì—ì„œëŠ” ë†’ì€ ìˆ˜ì¸ 48ì„ ì‚¬ìš©í•˜ì—¬ 4ì‹œê°„ í›„ì˜ êµí†µ ì†ë„ë¥¼ ì˜ˆì¸¡í•  ê²ƒì´ë‹¤.

#### ì‹œê³„ì—´ ìŠ¬ë¼ì´ë”© ìœˆë„ìš° ìƒì„±

1. lags(ë°ì´í„° ìƒ˜í”Œì˜ ìˆ˜) ê°’, horizon, ì…ë ¥ í–‰ë ¬, ì •ë‹µ í–‰ë ¬ ë³€ìˆ˜ë“¤ì„ ì´ˆê¸°í™”í•œë‹¤.

```python
# ì‹œê³„ì—´ ë°ì´í„° ì¤€ë¹„
lags = 24      # ê³¼ê±° 24ê°œ ì‹œì  (2ì‹œê°„)
horizon = 48   # ë¯¸ë˜ 48ê°œ ì‹œì  (4ì‹œê°„)

xs = []
ys = []
```

2. ê° ì‹œê°„ tì— ëŒ€í•´ ì´ì „ 12ê°œ ê°’ì„ xsì— ì €ì¥í•˜ê³  t+h ì‹œê°„ì˜ ê°’ì„ ysì— ì €ì¥í•œë‹¤.

```python
for i in range(lags, speeds_norm.shape[0]-horizon):
    xs.append(speeds_norm.to_numpy()[i-lags:i].T)
    ys.append(speeds_norm.to_numpy()[i+horizon-1])
```

#### PyTorch Geometric Temporal ë°ì´í„°ì…‹ ìƒì„±

3. ë§ˆì§€ë§‰ìœ¼ë¡œ PyTorch Geometric Temporalì„ ì‚¬ìš©í•˜ì—¬ ì‹œê³„ì—´ ê·¸ë˜í”„ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì—£ì§€ ì¸ë±ìŠ¤ì™€ ì—£ì§€ ê°€ì¤‘ì¹˜ëŠ” COO í˜•ì‹ìœ¼ë¡œ ì œê³µë˜ì–´ì•¼ í•œë‹¤.

```python
from torch_geometric_temporal.signal import StaticGraphTemporalSignal

# ì¸ì ‘ í–‰ë ¬ì„ edge_index í˜•ì‹ìœ¼ë¡œ ë³€í™˜
edge_index = (np.array(adj) > 0).nonzero()
edge_weight = adj[adj > 0]

# ë°ì´í„°ì…‹ ìƒì„±
dataset = StaticGraphTemporalSignal(edge_index, adj[adj > 0], xs, ys)
```

4. ëª¨ë“  ì •ë³´ê°€ ì •ìƒì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì²« ë²ˆì§¸ ê·¸ë˜í”„ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¶œë ¥í•´ë³´ì.

```python
dataset[0]
```

ì¶œë ¥:
```
Data(x=[228, 12], edge_index=[2, 1664], edge_attr=[1664], y=[228])
```

5. ë°ì´í„°ì…‹ì„ í›ˆë ¨/í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¡œ ë¶„í• í•œë‹¤.

```python
from torch_geometric_temporal.signal import temporal_signal_split
train_dataset, test_dataset = temporal_signal_split(dataset, train_ratio=0.8)
```

ìµœì¢…ì ìœ¼ë¡œ ì–»ì€ ì‹œê³„ì—´ ê·¸ë˜í”„ëŠ” 12ê°œì˜ ê°’, 1664ê°œì˜ ì—°ê²°, 228ê°œì˜ ë…¸ë“œë¡œ êµ¬ì„±ëœë‹¤. ì´ì œ êµí†µ ì˜ˆì¸¡ì— T-GNNì„ ì ìš©í•´ë³´ì.

---

## ğŸ›ï¸ A3T-GCN ì•„í‚¤í…ì²˜ êµ¬í˜„

### A3T-GCN ì†Œê°œ

ì´ ì„¹ì…˜ì—ì„œëŠ” êµí†µ ì˜ˆì¸¡ì„ ìœ„í•´ ì„¤ê³„ëœ Attention Temporal Graph Convolutional Network (A3T-GCN)ì— ëŒ€í•´ í•™ìŠµí•  ê²ƒì´ë‹¤. ì´ ì•„í‚¤í…ì²˜ëŠ” ë³µì¡í•œ ê³µê°„ì  ë° ì‹œê°„ì  ì˜ì¡´ì„±ì„ ê³ ë ¤í•œë‹¤.

| ì˜ì¡´ì„± ìœ í˜• | ì„¤ëª… | ì˜ˆì‹œ |
|-------------|------|------|
| **ê³µê°„ì  ì˜ì¡´ì„±** | í•œ ìœ„ì¹˜ì˜ êµí†µ ìƒíƒœê°€ ì£¼ë³€ ìœ„ì¹˜ì˜ êµí†µ ìƒíƒœì— ì˜í–¥ì„ ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ë‚˜íƒ€ë‚¸ë‹¤ | êµí†µ ì²´ì¦ì€ ì£¼ë³€ ë„ë¡œë¡œ ìì£¼ í™•ì‚°ëœë‹¤ |
| **ì‹œê°„ì  ì˜ì¡´ì„±** | í•œ ìœ„ì¹˜ì˜ íŠ¹ì • ì‹œê°„ì˜ êµí†µ ìƒíƒœê°€ ì´ì „ ì‹œê°„ì˜ ë™ì¼í•œ ìœ„ì¹˜ì˜ êµí†µ ìƒíƒœì— ì˜í–¥ì„ ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ë‚˜íƒ€ë‚¸ë‹¤ | ì•„ì¹¨ ì¶œê·¼ ì‹œê°„ì˜ êµí†µ íŒ¨í„´ì€ ì´ì „ ë‚ ì˜ íŒ¨í„´ê³¼ ìœ ì‚¬í•  ìˆ˜ ìˆë‹¤ |

A3T-GCNì€ Temporal GCN (TGCN)ì˜ ê°œì„ ëœ ì•„í‚¤í…ì²˜ì´ë‹¤. TGCNì€ GCN (Graph Convolutional Network)ê³¼ GRU (Gated Recurrent Unit)ë¥¼ ê²°í•©í•˜ì—¬ ê° ì…ë ¥ ì‹œê³„ì—´ì—ì„œ ìˆ¨ê²¨ì§„ ë²¡í„°ë¥¼ ìƒì„±í•˜ë©°, ê³µê°„ì  ë° ì‹œê°„ì  ì •ë³´ë¥¼ ëª¨ë‘ ìº¡ì²˜í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ attention ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ê°€ì¤‘ì¹˜ë¥¼ ê³„ì‚°í•˜ê³  "context vector"ë¥¼ ë„ì¶œí•˜ë©°, ì´ëŠ” ìµœì¢… ì˜ˆì¸¡ì˜ ê¸°ë°˜ì´ ëœë‹¤. attention ëª¨ë¸ì˜ í¬í•¨ì€ ì „ì²´ì ì¸ íŠ¸ë Œë“œë¥¼ ì´í•´í•˜ëŠ” ë° ì¤‘ìš”í•˜ë‹¤.

![A3T-GCN êµ¬ì¡°](./images/a3t_gcn.png)

**ê·¸ë¦¼ 15.8 A3T-GCNì˜ êµ¬ì¡°**

### ëª¨ë¸ êµ¬í˜„

PyTorch Geometric Temporal ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ì„ êµ¬í˜„í•  ê²ƒì´ë‹¤.

1. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„í¬íŠ¸í•œë‹¤.

```python
import torch
from torch_geometric_temporal.nn.recurrent import A3TGCN
```

2. 32ê°œì˜ ìˆ¨ê²¨ì§„ ì°¨ì›ì„ ê°€ì§„ ì„ í˜• ë ˆì´ì–´ì™€ A3TGCN ë ˆì´ì–´ë¡œ êµ¬ì„±ëœ T-GNNì„ ìƒì„±í•  ê²ƒì´ë‹¤. edge_attr ë§¤ê°œë³€ìˆ˜ëŠ” ì—£ì§€ ê°€ì¤‘ì¹˜ ê°’ì„ ì „ë‹¬í•  ê²ƒì´ë‹¤.

```python
class TemporalGNN(torch.nn.Module):
    def __init__(self, dim_in, periods):
        super().__init__()
        self.tgnn = A3TGCN(in_channels=dim_in, out_channels=32, periods=periods)
        self.linear = torch.nn.Linear(32, periods)

    def forward(self, x, edge_index, edge_attr):
        h = self.tgnn(x, edge_index, edge_attr).relu()
        h = self.linear(h)
        return h

# ëª¨ë¸ ì´ˆê¸°í™”
model = TemporalGNN(lags, 1).to('cpu')
optimizer = torch.optim.Adam(model.parameters(), lr=0.005)
```

### ëª¨ë¸ êµ¬ì¡°

ëª¨ë¸ì˜ êµ¬ì¡°ë¥¼ í™•ì¸í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤:

```
TemporalGNN(
  (tgnn): A3TGCN(
    (_base_tgcn): TGCN(
      (conv_z): GCNConv(24, 32)
      (linear_z): Linear(in_features=64, out_features=32, bias=True)
      (conv_r): GCNConv(24, 32)
      (linear_r): Linear(in_features=64, out_features=32, bias=True)
      (conv_h): GCNConv(24, 32)
      (linear_h): Linear(in_features=64, out_features=32, bias=True)
    )
  )
  (linear): Linear(in_features=32, out_features=1, bias=True)
)
```

### ëª¨ë¸ í›ˆë ¨

ì´ì œ ëª¨ë¸ì„ í›ˆë ¨ì‹œì¼œë³´ì.

```python
# í›ˆë ¨ ë£¨í”„
model.train()
for epoch in range(30):
    loss = 0
    step = 0
    for i, snapshot in enumerate(train_dataset):
        y_pred = model(snapshot.x.unsqueeze(2), snapshot.edge_index, snapshot.edge_attr)
        loss += torch.mean((y_pred-snapshot.y)**2)
        step += 1
    loss = loss / (step + 1)
    loss.backward()
    optimizer.step()
    optimizer.zero_grad()
    if epoch % 5 == 0:
        print(f"Epoch {epoch:>2} | Train MSE: {loss:.4f}")
```

**í›ˆë ¨ ê²°ê³¼**:
```
Epoch  0 | Train MSE: 1.0114
Epoch  5 | Train MSE: 0.9806
Epoch 10 | Train MSE: 0.9603
Epoch 15 | Train MSE: 0.9373
Epoch 20 | Train MSE: 0.9167
Epoch 25 | Train MSE: 0.9027
```

í›ˆë ¨ì´ ì§„í–‰ë¨ì— ë”°ë¼ ì†ì‹¤ì´ ì ì§„ì ìœ¼ë¡œ ê°ì†Œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

---

## ğŸ“ˆ ì‹¤í—˜ ê²°ê³¼ ë° ì„±ëŠ¥ í‰ê°€

### ì„±ëŠ¥ í‰ê°€ í•¨ìˆ˜

ëª¨ë¸ì˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ì§€í‘œë¥¼ ì‚¬ìš©í•œë‹¤.

```python
def MAE(real, pred):
    return np.mean(np.abs(pred - real))

def RMSE(real, pred):
    return np.sqrt(np.mean((pred - real) ** 2))

def MAPE(real, pred):
    return np.mean(np.abs(pred - real) / (real + 1e-5))
```

### ì˜ˆì¸¡ ê²°ê³¼ ìƒì„±

ì´ì œ í›ˆë ¨ëœ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ì„ ìˆ˜í–‰í•˜ê³ , ê¸°ì¤€ì„  ëª¨ë¸ë“¤ê³¼ ë¹„êµí•´ë³´ì.

```python
# ì—­ì •ê·œí™” í•¨ìˆ˜
def inverse_zscore(x, mean, std):
    return x * std + mean

# í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¤€ë¹„
y_test = []
for snapshot in test_dataset:
    y_hat = snapshot.y.numpy()
    y_hat = inverse_zscore(y_hat, speeds.mean(axis=0), speeds.std(axis=0))
    y_test = np.append(y_test, y_hat)

# A3T-GCN ì˜ˆì¸¡
gnn_pred = []
model.eval()
for snapshot in test_dataset:
    y_hat = model(snapshot.x.unsqueeze(2), snapshot.edge_index, snapshot.edge_weight).squeeze().detach().numpy()
    y_hat = inverse_zscore(y_hat, speeds.mean(axis=0), speeds.std(axis=0))
    gnn_pred = np.append(gnn_pred, y_hat)

# Random Walk ì˜ˆì¸¡ (ê¸°ì¤€ì„ )
rw_pred = []
for snapshot in test_dataset:
    y_hat = snapshot.x[:,-1].squeeze().detach().numpy()
    y_hat = inverse_zscore(y_hat, speeds.mean(axis=0), speeds.std(axis=0))
    rw_pred = np.append(rw_pred, y_hat)

# Historical Average ì˜ˆì¸¡ (ê¸°ì¤€ì„ )
ha_pred = []
for i in range(lags, speeds_norm.shape[0]-horizon):
    y_hat = speeds_norm.to_numpy()[:i].T.mean(axis=1)
    y_hat = inverse_zscore(y_hat, speeds.mean(axis=0), speeds.std(axis=0)) 
    ha_pred.append(y_hat)
ha_pred = np.array(ha_pred).flatten()[-len(y_test):]
```

### ì„±ëŠ¥ ë¹„êµ

| ëª¨ë¸ | MAE | RMSE | MAPE |
|------|-----|------|------|
| **A3T-GCN** | 8.3552 | 11.9278 | 0.1505 |
| **Random Walk** | 11.0469 | 17.6501 | 0.2999 |
| **Historical Average** | 9.3374 | 13.1518 | 0.1633 |

**ê²°ê³¼ ë¶„ì„**:

| ë¶„ì„ í•­ëª© | ì„¤ëª… | ì˜ë¯¸ |
|-----------|------|------|
| **A3T-GCNì˜ ìš°ìˆ˜ì„±** | ëª¨ë“  í‰ê°€ ì§€í‘œì—ì„œ ìµœê³  ì„±ëŠ¥ì„ ë‹¬ì„± | ê³µê°„-ì‹œê°„ ì˜ì¡´ì„± ëª¨ë¸ë§ì˜ íš¨ê³¼ |
| **ê°œì„ ìœ¨** | MAE ê¸°ì¤€ìœ¼ë¡œ Random Walk ëŒ€ë¹„ 24.4% í–¥ìƒ | ìƒë‹¹í•œ ì„±ëŠ¥ ê°œì„  |
| **ì˜ì˜** | ê³µê°„-ì‹œê°„ ì˜ì¡´ì„±ì„ ë™ì‹œì— ëª¨ë¸ë§í•˜ëŠ” ê²ƒì´ êµí†µ ì˜ˆì¸¡ì— ì¤‘ìš”í•¨ì„ ì…ì¦ | ë°©ë²•ë¡ ì˜ ì‹¤ìš©ì„± |

**Q. RÂ²(R-squared)ëŠ” ì–¼ë§ˆë‚˜ ë‚˜ì˜¬ê¹Œ?** 


RÂ²ëŠ” ê²°ì •ê³„ìˆ˜(Coefficient of Determination)ë¡œ, íšŒê·€ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ëŠ” ì§€í‘œì…ë‹ˆë‹¤. RÂ²ì˜ ë²”ìœ„ëŠ” ì´ë¡ ì ìœ¼ë¡œ -âˆë¶€í„° 1ê¹Œì§€ì´ë©°, ì‹¤ì œë¡œëŠ” 0~1 ì‚¬ì´ì˜ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤. RÂ² = 1ì¼ ë•ŒëŠ” ì™„ë²½í•œ ì˜ˆì¸¡ì„, RÂ² = 0ì¼ ë•ŒëŠ” í‰ê· ê°’ìœ¼ë¡œë§Œ ì˜ˆì¸¡í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ì„±ëŠ¥ì„, RÂ² < 0ì¼ ë•ŒëŠ” í‰ê· ê°’ë³´ë‹¤ë„ ë‚˜ìœ ì˜ˆì¸¡ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™”ë¥¼ í†µí•´ ë¶„ì„í•œ ê²°ê³¼, A3T-GCN ëª¨ë¸ì€ êµí†µ ì†ë„ì˜ ì£¼ê¸°ì  íŒ¨í„´ê³¼ ì‹œê°„ì  ë³€ë™ì„ ìƒë‹¹íˆ ì •í™•í•˜ê²Œ í¬ì°©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì˜ˆì¸¡ì„ ì´ ì‹¤ì œ í‰ê· ì„ ì˜ ì „ë°˜ì ì¸ íŒ¨í„´ì„ ì˜ ë”°ë¼ê°€ë©´ì„œë„, í”¼í¬ì™€ ì €ì ì˜ ì§„í­ì—ì„œ ì•½ê°„ì˜ ì°¨ì´ë¥¼ ë³´ì´ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì‹œê°ì  ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” RÂ² ê°’ì€ 0.65-0.75 ë²”ìœ„ë¡œ ì¶”ì •ë˜ë©°, ì´ëŠ” êµí†µ ì˜ˆì¸¡ ë¶„ì•¼ì—ì„œ ì‹¤ìš©ì ìœ¼ë¡œ ë§¤ìš° ìš°ìˆ˜í•œ ì„±ëŠ¥ ìˆ˜ì¤€ì…ë‹ˆë‹¤. êµí†µ ë°ì´í„°ì˜ ë†’ì€ ë¶ˆí™•ì‹¤ì„±ê³¼ ì™¸ë¶€ ìš”ì¸(ë‚ ì”¨, ì‚¬ê³ , ì´ë²¤íŠ¸ ë“±)ì„ ê³ ë ¤í•  ë•Œ, ì´ ì •ë„ì˜ RÂ²ëŠ” ëª¨ë¸ì´ êµí†µ íŒ¨í„´ì˜ í•µì‹¬ì„ ì˜ í•™ìŠµí–ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ë©°, ê³µê°„-ì‹œê°„ ì˜ì¡´ì„±ì„ ë™ì‹œì— ëª¨ë¸ë§í•˜ëŠ” A3T-GCNì˜ íš¨ê³¼ë¥¼ ì…ì¦í•©ë‹ˆë‹¤.
ì°¸ê³  ìë£Œ | [í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ì„œ íšŒê·€ ëª¨ë¸ì˜ ê²°ì •ê³„ìˆ˜ê°€(R2) ìŒìˆ˜ê°€ ë‚˜ì˜¤ëŠ” ì´ìœ ](https://bluediary8.tistory.com/159#google_vignette)



### ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™”

ë§ˆì§€ë§‰ìœ¼ë¡œ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ì—¬ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•´ë³´ì.

```python
# ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™”
y_preds = [inverse_zscore(model(snapshot.x.unsqueeze(2), snapshot.edge_index, snapshot.edge_weight).squeeze().detach().numpy(), speeds.mean(axis=0), speeds.std(axis=0)).mean() for snapshot in test_dataset]

mean = speeds.mean(axis=1)
std = speeds.std(axis=1)

plt.figure(figsize=(10,5))
plt.plot(np.array(mean), 'k-', label='Mean')
plt.plot(range(len(speeds)-len(y_preds), len(speeds)), y_preds, 'r-', label='Prediction')
plt.grid(linestyle=':')
plt.fill_between(mean.index, mean-std, mean+std, color='r', alpha=0.1)
plt.axvline(x=len(speeds)-len(y_preds), color='b', linestyle='--')
plt.xlabel('Time (5 min)')
plt.ylabel('Traffic speed to predict')
plt.legend(loc='upper right')
```

![ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™”](./images/predict.png)

**ì‹œê°í™” ë¶„ì„**:

| ë¶„ì„ í•­ëª© | ì„¤ëª… | ì˜ë¯¸ |
|-----------|------|------|
| **ì˜ˆì¸¡ ì •í™•ë„** | ëª¨ë¸ì´ ì‹¤ì œ í‰ê·  íŒ¨í„´ì„ ì˜ ë”°ë¼ê°€ëŠ” ê²ƒì„ í™•ì¸ | ëª¨ë¸ì˜ í•™ìŠµ ì„±ê³µ |
| **ë³€ë™ì„± í¬ì°©** | êµí†µ ì†ë„ì˜ ë³€ë™ì„ ì ì ˆíˆ ì˜ˆì¸¡í•˜ê³  ìˆìŒ | íŒ¨í„´ ì¸ì‹ ëŠ¥ë ¥ |
| **ì‹œê°„ì  ì¼ê´€ì„±** | ì˜ˆì¸¡ì´ ì‹œê°„ì— ë”°ë¼ ì¼ê´€ëœ íŒ¨í„´ì„ ë³´ì„ | ëª¨ë¸ì˜ ì•ˆì •ì„± |

### ëª¨ë¸ ì„±ëŠ¥ ë¶„ì„

T-GNNì€ ì¼ë°˜ì ìœ¼ë¡œ íŠ¸ë Œë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ë”°ë¥´ì§€ë§Œ, ì˜ˆì¸¡ëœ ì†ë„ê°€ ì „ì²´ í‰ê· ì— ê°€ê¹Œìš´ ê²½í–¥ì´ ìˆì–´ MSE ì†ì‹¤ í•¨ìˆ˜ë¡œ ì¸í•´ ìƒë‹¹í•œ ì˜¤ë¥˜ì™€ ë” í° ì†ì‹¤ì„ ì´ˆë˜í•œë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  GNNì€ ìƒë‹¹íˆ ì •í™•í•˜ë©°, ë” ê·¹ë‹¨ì ì¸ ê°’ì„ ì¶œë ¥í•˜ë„ë¡ "ë¯¸ì„¸ ì¡°ì •"ë˜ì—ˆë‹¤.

---

## ğŸ¯ í•™ìŠµí•œ ë‚´ìš© ìš”ì•½

ì´ ì¥ì„ ë§ˆì¹˜ë©´, ì •í˜•(tabular) ë°ì´í„°ì—ì„œ ì‹œê³„ì—´ ê·¸ë˜í”„ ë°ì´í„°ì…‹ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ì•Œê²Œ ë  ê²ƒì´ë‹¤. íŠ¹íˆ ìš°ë¦¬ëŠ” ê°„ì„  ê°€ì¤‘ì¹˜ë¥¼ ì œê³µí•˜ëŠ” ê°€ì¤‘ ì¸ì ‘ í–‰ë ¬ì„ ì–´ë–»ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³¼ ê²ƒì´ë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ T-GNNì„ êµí†µ ì˜ˆì¸¡ ì‘ì—…ì— ì ìš©í•˜ê³  ê²°ê³¼ë¥¼ í‰ê°€í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ê²Œ ë  ê²ƒì´ë‹¤.

### í•µì‹¬ ì„±ê³¼

| ì„±ê³¼ ì˜ì—­ | ì„¤ëª… | ì˜ë¯¸ |
|-----------|------|------|
| **ë°ì´í„° ì²˜ë¦¬** | CSV íŒŒì¼ì—ì„œ ì‹œê³„ì—´ ê·¸ë˜í”„ ë°ì´í„°ì…‹ ìƒì„± | ë°ì´í„° ì „ì²˜ë¦¬ ê¸°ìˆ  ìŠµë“ |
| **ëª¨ë¸ êµ¬í˜„** | A3T-GCN ì•„í‚¤í…ì²˜ë¥¼ í™œìš©í•œ êµí†µ ì˜ˆì¸¡ ëª¨ë¸ | ì‹¤ì œ ëª¨ë¸ êµ¬í˜„ ê²½í—˜ |
| **ì„±ëŠ¥ ê²€ì¦** | ê¸°ì¡´ ë°©ë²• ëŒ€ë¹„ 24% ì„±ëŠ¥ í–¥ìƒ ë‹¬ì„± | ë°©ë²•ë¡ ì˜ ì‹¤ìš©ì„± ì…ì¦ |

### ì‹¤ìš©ì  ì˜ë¯¸

| ì ìš© ë¶„ì•¼ | ì„¤ëª… | ê°€ì¹˜ |
|-----------|------|------|
| **ì •í™•í•œ ì˜ˆì¸¡** | MAE 8.36ìœ¼ë¡œ ì‹¤ìš©ì ì¸ ìˆ˜ì¤€ì˜ ì˜ˆì¸¡ ì •í™•ë„ | ì‹¤ë¬´ ì ìš© ê°€ëŠ¥ì„± |
| **ì‹¤ì‹œê°„ ì ìš©** | 5ë¶„ ê°„ê²© ë°ì´í„°ë¡œ ì‹¤ì‹œê°„ êµí†µ ê´€ë¦¬ ê°€ëŠ¥ | ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ êµ¬ì¶• |
| **í™•ì¥ì„±** | ë‹¤ë¥¸ ë„ì‹œë‚˜ ë„ë¡œ ë„¤íŠ¸ì›Œí¬ì— ì ìš© ê°€ëŠ¥í•œ ë²”ìš©ì„± | ë²”ìš©ì  ì ìš© ê°€ëŠ¥ |

---

## ğŸ“š ë” ì½ì„ê±°ë¦¬

- **[1]** B. Yu, H. Yin, and Z. Zhu. "Spatio-Temporal Graph Convolutional Networks: A Deep Learning Framework for Traffic Forecasting." July 2018. DOI: 10.24963/ijcai.2018/505, arXiv: https://arxiv.org/abs/1709.04875
- **[2]** Y. Li, R. Yu, C. Shahabi, and Y. Liu. "Diffusion Convolutional Recurrent Neural Network: Data-Driven Traffic Forecasting." 2017. DOI: 10.48550/ARXIV.1707.01926, arXiv: https://arxiv.org/abs/1707.01926

---

## ğŸ“š ê´€ë ¨ ìë£Œ

- **[PeMS ë°ì´í„°ì…‹](https://pems.dot.ca.gov/)**: California êµí†µ ë°ì´í„°
- **[A3T-GCN ë…¼ë¬¸](https://arxiv.org/abs/2006.11583)**: ì›ë³¸ ì—°êµ¬ ë…¼ë¬¸
- **[PyTorch Geometric Temporal](https://pytorch-geometric-temporal.readthedocs.io/)**: ì‹œê³„ì—´ ê·¸ë˜í”„ ì‹ ê²½ë§ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **[ì´ì „ ì±•í„°: Chapter 14](../WEEK06/preview14.md)**: GNN ì„¤ëª… ê°€ëŠ¥ì„±
- **[ë‹¤ìŒ ì±•í„°: Chapter 16](../WEEK07/chapter16.ipynb)**: ê·¸ë˜í”„ ìƒì„± ëª¨ë¸
